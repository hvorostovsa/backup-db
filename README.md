# PostgreSQL с автоматическим резервным копированием

## Структура проекта

*   `docker-compose.yml`: Основной файл для определения и запуска сервисов Docker.
*   `Dockerfile.pg-backup`: Dockerfile для создания образа сервиса резервного копирования.
*   `scripts/backup_entrypoint.sh`: Скрипт, который выполняет резервное копирование и настраивает cron.
*   `backups/`: Папка, в которой хранятся созданные резервные копии.

## Конфигурация

Все основные настройки находятся в файле `docker-compose.yml`.

### Сервис `pg-backup`

*   `PGHOST`, `PGUSER`, `PGPASSWORD`, `PGPORT`: Параметры для подключения к базе данных. Должны соответствовать настройкам сервиса `postgres`.
*   `CRON_SCHEDULE`: Расписание для создания резервных копий в формате cron. По умолчанию установлено на `* 3 * * *` (каждый день в 03:00).
*   `TZ`: Часовой пояс для контейнера.

## Запуск

```bash
docker-compose up -d
```
Эта команда запустит два контейнера:
1.  `postgres-test`: Контейнер с базой данных PostgreSQL.
2.  `postgres-backup`: Контейнер, который будет создавать резервные копии по расписанию.

Резервные копии будут автоматически сохраняться в папку `backups/`.

## Восстановление из резервной копии

Для восстановления базы данных из файла резервной копии:

1.  Выбираем файл резервной копии из папки `backups/`. Например, `all_2025-09-25_22-04-01.sql.gz`.

2.  команда для восстановления

    **Для Linux / macOS:**

    ```bash
    gunzip -c ./backups/[BACKUP_FILENAME] | docker exec -i [CONTAINER_NAME] psql -U [USER] -d [DB_NAME]
    ```
    
    **Пример для текущего проекта:**

    ```bash
    gunzip -c ./backups/all_2025-09-25_22-04-01.sql.gz | docker exec -i postgres-test psql -U admin -d test_db
    ```

Эта команда распакует архив и передаст его содержимое в `psql` внутри контейнера, который восстановит все базы данных. 
